{% extends "rearch.html" %}
{% load static %}

{% block product_details %}
<div class="row mt-5">
    <aside class="col-lg-6">
        <div class="border rounded-4 mb-3 d-flex justify-content-center">
            <img id="mainImage" style="max-width: 100%; max-height: 100vh; margin: auto; border: 2px solid #007bff; transition: transform 0.2s;" class="rounded-4 fit" src="{{ pro.image.url }}" alt="Product Image" onclick="resetImage()" />
        </div>
        <div class="d-flex justify-content-center mb-3">
            <!-- Thumbnails -->
            {% for image in pro.images.all %}
            <a class="border mx-1 rounded-2" href="javascript:void(0);" onclick="changeImage('{{ image.image.url }}')">
                <img width="60" height="60" class="rounded-2 thumbnail-img" src="{{ image.image.url }}" alt="Product Thumbnail" />
            </a>
            {% endfor %}
            <!-- End Thumbnails -->
        </div>
    </aside>

    <main class="col-lg-6">
        <div class="ps-lg-3">
            <h4 class="title text-dark" style="font-size: 1.8rem;">{{ pro.name }}</h4>
            <div class="d-flex flex-row my-3 align-items-center">
                <div class="text-warning mb-1 me-2">
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fas fa-star-half-alt"></i>
                    <span class="ms-1">4.5</span>
                </div>
                <span class="text-muted">
                    <i class="fas fa-shopping-basket fa-sm mx-1"></i> {{ pro.order_set.count }} orders
                </span>
                <span class="text-success ms-2">{{ pro.stock }} In stock</span>
            </div>

            <div class="mb-3">
                <span class="h5 text-primary" style="font-size: 1.5rem;">{{ pro.price }} $</span>
            </div>

            <!-- Short Description -->
            <p class="short-description mb-2 text-muted" style="font-size: 1.1rem;">{{ pro.short_description }}</p>

            <!-- Category Badge -->
            <span class="badge bg-info text-dark" style="font-size: 1rem;">{{ pro.category.name }}</span>

            <!-- Color and Size Selection -->
            <form method="POST" action="{% url 'ajoute' pro.slug %}">
                {% csrf_token %}
                
                <div class="mt-3">
                    <label for="colorSelect" class="form-label">Select Color:</label>
                    <div id="colorSelect" class="mb-3">
                        {% for color in pro.productattr_set.all %}
                        <button type="button" class="color-btn"
                                style="background-color: {{ color.color.hex_code }}; border-radius: 50%; width: 40px; height: 40px; margin-right: 5px; border: 2px solid transparent; transition: border-color 0.3s;"
                                onclick="document.getElementById('selectedColor').value='{{ color.color.name }}';">
                        </button>
                        {% endfor %}
                    </div>
                    <input type="hidden" name="color" id="selectedColor" />
                </div>
            
                <label for="sizeSelect" class="form-label">Select Size:</label>
                <select id="sizeSelect" name="size" class="form-select">
                    <option value="">Choose size</option>
                    {% for size in pro.productattr_set.all %}
                    <option value="{{ size.size.name }}">{{ size.size.name }}</option>
                    {% endfor %}
                </select>
            
                <button type="submit" class="btn btn-primary mt-3">Save Selection</button>
            </form>
            
            <p class="mb-4" style="font-size: 1.1rem;">{{ pro.description }}</p>

            {% if user.is_authenticated %}
            <div class="d-flex flex-column">
                <a href="{% url 'ajoute' pro.slug %}" class="btn btn-primary shadow-0 mb-2" style="font-size: 1.1rem;">
                    <i class="me-1 fa fa-shopping-basket"></i> Add to cart
                </a>
                <a href="{% url 'save' pro.slug %}" class="btn btn-warning shadow-0" style="font-size: 1.1rem;">Save</a>
              
            </div>
            {% endif %}
        </div>
    </main>
</div>

<!-- Pills navs (fixed layout) -->
<div class="tab-content" id="pills-tabContent">
    <div class="tab-pane fade show active" id="pills-description" role="tabpanel" aria-labelledby="pills-description-tab">
        <p style="font-size: 1.1rem;">{{ pro.long_description }}</p>
    </div>
    <div class="tab-pane fade" id="pills-reviews" role="tabpanel" aria-labelledby="pills-reviews-tab">
        <p>Reviews will be shown here.</p>
    </div>
</div>

<section class="py-5" style="background-color: #f8f9fa;">
    <div class="container px-4 px-lg-5 mt-5">
        <div class="row gx-4 gx-lg-5 row-cols-1 row-cols-md-2 row-cols-xl-3 justify-content-center">
            {% for o in rel %}
            <div class="col mb-5">
                <div class="card h-100 shadow-sm rounded border-0">
                    <!-- Category Badge -->
                    <span class="badge bg-info text-dark position-absolute mt-3 ms-3">{{ o.category.name }}</span>
                    
                    <!-- Product Image -->
                    <img class="card-img-top" src="{{ o.image.url }}" alt="{{ o.name }}" style="height: 250px; object-fit: contain;" />
                    
                    <!-- Product Info -->
                    <div class="card-body p-4 text-center">
                        <h5 class="fw-bolder">{{ o.name }}</h5>
                        <span class="text-muted">{{ o.prix }} $</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<script>
    // Store the original image URL
    const originalImage = '{{ pro.image.url }}';
    
    function changeImage(imageUrl) {
        const mainImage = document.getElementById('mainImage');
        mainImage.style.opacity = 0; // Fade out
        setTimeout(() => {
            mainImage.src = imageUrl; // Change the image
            mainImage.style.opacity = 1; // Fade in
        }, 200); // Adjust timing to match transition
    }

    function resetImage() {
        changeImage(originalImage);
    }
</script>
{% endblock %}
