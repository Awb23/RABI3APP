{% extends "base.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<style>
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
        animation: fadeIn 0.5s ease;
    }
</style>
{% include "header.html" %}
<section class="cart-section py-8 bg-gray-50">
    <div class="container mx-auto px-4">
        <h2 class="text-3xl font-bold text-gray-900 text-center mb-6">Your Shopping Cart</h2>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="col-span-1 lg:col-span-2">
                <div class="bg-white rounded-lg shadow-sm p-6 animate-fade-in">
                    <div class="flex justify-between items-center bg-gradient-to-r from-blue-600 to-indigo-500 text-white rounded-t-lg p-4">
                        <h3 class="text-xl font-semibold">Cart - {{ orders.count }} Items</h3>
                    </div>
                    <div class="p-4">
                        {% if orders %}
                            {% for order in orders %}
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4 border-b pb-4 hover:bg-gray-50 transition-all duration-300">
                                <div class="col-span-1">
                                    <img src="{{ order.produit.image.url }}" class="w-full h-32 object-contain rounded-lg" alt="{{ order.produit.name }}" />
                                </div>
                                <div class="col-span-2">
                                    <h4 class="text-lg font-bold text-gray-900">{{ order.produit.name }}</h4>
                                    <p class="text-gray-600">Color: {{ order.produit.colors.first.name }}</p>
                                    <p class="text-gray-600">Size: {{ order.produit.sizes.first.name }}</p>
                                    <form method="post" action="{% url 'update_quantity' order.id %}" class="flex items-center mt-2">
                                        {% csrf_token %}
                                        <div class="flex items-center space-x-2">
                                            <button type="submit" class="w-8 h-8 bg-blue-100 text-blue-600 rounded-full hover:bg-blue-200 transition-colors duration-200" onclick="this.parentNode.querySelector('input[type=number]').stepDown()">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <input min="1" name="quantity" value="{{ order.quantiti }}" type="number" class="w-12 text-center border rounded-md focus:ring-2 focus:ring-blue-400" />
                                            <button type="submit" class="w-8 h-8 bg-blue-100 text-blue-600 rounded-full hover:bg-blue-200 transition-colors duration-200" onclick="this.parentNode.querySelector('input[type=number]').stepUp()">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                    </form>
                                    <div class="mt-3 text-right">
                                        <form method="post" action="{% url 'delete' order.produit.slug %}" class="inline-block">
                                            {% csrf_token %}
                                            <button type="submit" class="px-3 py-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors duration-200">
                                                <i class="fas fa-trash mr-1"></i> Remove
                                            </button>
                                        </form>
                                        <span class="text-lg font-semibold text-indigo-600 ml-3">${{ order.produit.price }}</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="text-center py-8">
                                <img src="{% static 'images/empty-cart.svg' %}" alt="Empty Cart" class="w-24 h-24 mx-auto mb-4" />
                                <p class="text-gray-600">Your cart is empty. Please add some products.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="col-span-1">
                <div class="bg-white rounded-lg shadow-sm p-6 animate-fade-in">
                    <div class="flex justify-between items-center bg-gradient-to-r from-green-600 to-emerald-500 text-white rounded-t-lg p-4">
                        <h3 class="text-xl font-semibold">Order Summary</h3>
                    </div>
                    <div class="p-4">
                        <ul class="space-y-3">
                            <li class="flex justify-between items-center">
                                <span class="text-gray-700">Products</span>
                                <span class="text-gray-600">${{ amount }}</span>
                            </li>
                            <li class="flex justify-between items-center">
                                <span class="text-gray-700">Shipping</span>
                                <span class="text-gray-600">Free</span>
                            </li>
                            <li class="flex justify-between items-center pt-3 border-t border-gray-200">
                                <span class="text-gray-900 font-bold">Total (incl. VAT)</span>
                                <span class="text-gray-900 font-bold">${{ total }}</span>
                            </li>
                        </ul>
                        {% if user.is_authenticated and orders %}
                        <div class="mt-4">
                            <button id="whatsapp-order-btn" class="block w-full px-6 py-3 bg-green-500 text-white rounded-full hover:bg-green-600 transition-colors duration-200 text-center font-bold">
                                <i class="fab fa-whatsapp mr-2"></i> Order via WhatsApp
                            </button>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% include "main.html" %}

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const whatsappBtn = document.getElementById('whatsapp-order-btn');
        if (whatsappBtn) {
            whatsappBtn.addEventListener('click', function() {
                // Get order details from the Django template
                const orders = [
                    {% for order in orders %}
                    {
                        name: "{{ order.produit.name }}",
                        quantity: "{{ order.quantiti }}",
                        price: "{{ order.produit.price }}",
                        
                    },
                    {% endfor %}
                ];
                
                const total = "{{ total }}";
                const username = "{{ user.username }}";
                
                // Build the WhatsApp message
                let message = `Hello, I'd like to place an order from your store.\n\n`;
                message += `*Customer Name:* ${username}\n\n`;
                message += `*Order Details:*\n`;
                
                orders.forEach(order => {
                    message += `_Product:_ ${order.name}\n`;
                    message += `_Quantity:_ ${order.quantity}\n`;
                    message += `_Price:_ $${order.price} each\n`;
                    if (order.color) {
                        message += `_Color:_ ${order.color}\n`;
                    }
                    if (order.size) {
                        message += `_Size:_ ${order.size}\n`;
                    }
                    message += `\n`;
                });
                
                message += `*Total Amount:* $${total}\n\n`;
                message += `Please confirm my order.`;
                
                // The WhatsApp number has been updated to your provided number
                const whatsappNumber = "+212627350926"; 
                
                // Create the WhatsApp URL
                const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
                
                // Open WhatsApp in a new tab
                window.open(whatsappUrl, '_blank');
            });
        }
    });
</script>
{% endblock content %}